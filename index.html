<!DOCTYPE html><html lang="pt_BR"><head><meta charset="utf8"/><title>Perfil do profissional</title><style>        /* Estilo da barra de navegação */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333; /* Cor de fundo da barra de navegação */
            color: #fff; /* Cor do texto da barra de navegação */
            padding: 10px 0;
        }

        .navbar a {
            color: #fff;
            text-decoration: none;
            padding: 15px;
        }

        /* Adicione margem ao corpo para evitar que o conteúdo fique oculto sob a barra de navegação */
        body {
            margin-top: 60px; /* Ajuste conforme necessário com base na altura da sua barra de navegação */
        }
        td {
            /*border: 1px solid #dfe2e5;*/
            background-color: transparent !important;
            border: 0 !important;
        }

        tr {
          border: 1px solid #dfe2e5 !important;
          background: transparent!important;
        }

        .tr:hover {
            background: #DFE2E5!important;
            cursor: pointer!important;
        }

        .tr:pressed {
            background: #9FA1A3!important;
        }

        .header {
            background-color: #F6F8FA !important;
        }

        .no-border {
            border: 0px solid #dfe2e5 !important;
        }

        ::backdrop {
          background-image: linear-gradient(
            45deg,
            rgb(0, 0, 0),
            rgb(0, 0, 0)
            );
          opacity: 0.75;
        }




      </style><meta content="lua-wpp" name="generator"/><meta content="width=device-width,initial-scale=1.0" name="viewport"/><link href="assets/css/style.css" rel="stylesheet"/>
      <script  src="https://unpkg.com/@supabase/supabase-js@2"></script>
      <script  src="assets/js/config.js"></script>
      </head>
      <body class="container-lg px-3 my-5 markdown-body"><div class="navbar"><a href="#"><span>Página inicial</span><span></span></a></div>

      <h3><br></h3>
      <table>
        <tr onclick="document.getElementById('login').showModal();" class="tr">
          <td><img src="assets/img/login.png" width="96" /></td>
          <td>
            <b>Acesso do profissional</b><br />Acesse sua produção individual, banco de horas e afins
          </td>
        </tr>
      </table>


      <dialog id="login" style="border: 0;">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td>CPF: </td>
            <td><input type="text" id="cpf" oninput="applyCPFFormat(this)" style="padding-left: 6;"></td>
          </tr>
          <tr class="no-border">
            <td>Senha: </td>
            <td><input id="senha" type="password" class="fixed-width">
              <button onclick="
                  senha.type = senha.type == 'password' ? 'text' : 'password';
                ">
                <svg width="14px" height="14px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 2L22 22" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M6.71277 6.7226C3.66479 8.79527 2 12 2 12C2 12 5.63636 19 12 19C14.0503 19 15.8174 18.2734 
                    17.2711 17.2884M11 5.05822C11.3254 5.02013 11.6588 5 12 5C18.3636 5 22 12 22 12C22 12 21.3082 
                    13.3317 20 14.8335" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  />
                  <path d="M14 14.2362C13.4692 14.7112 12.7684 15.0001 12 15.0001C10.3431 15.0001 9 13.657 9 
                    12.0001C9 11.1764 9.33193 10.4303 9.86932 9.88818" stroke="#000000" stroke-width="2" 
                    stroke-linecap="round" stroke-linejoin="round"
                  />
                </svg>
              </button>
              </td>
          </tr>
          <tr class="no-border">
            <td><button onclick="document.getElementById('login').close();document.getElementById('changeFirstPassword').close();">Cancelar</button></td>
            <td align="right"> <button onclick="login();">Acessar</button></td>
          </tr>
          <tr class="no-border">
            <td colspan="2"><a href="" onclick="
              event.preventDefault();
              novoCPF.value = '';
              novaSenha.value = '';
              novaSenhaConfirmar.value = '';
              document.getElementById('changeFirstPassword').showModal();
            ">Primeiro acesso com senha</a></td>
          </tr>

          <tr class="no-border">
            <td colspan="2"><a href="https://github.com/apstaiobeiras/apstaiobeiras.github.io/releases/download/untagged-ba12a030e7b6a4756484/plugin-esus.exe">Primeiro acesso com senha</a></td>
          </tr>
        </table>
      </dialog>

      <dialog id="changeFirstPassword" style="border: 0;">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td colspan="2">Olá, bem-vindo(a) agora o acesso é feito através de login e senha,<br>Digite o seu CPF e a senha que deseja usar<br><br></td>
          </tr>
          <tr class="no-border">
            <td>CPF: </td>
            <td><input type="text" id="novoCPF" oninput="applyCPFFormat(this)" style="padding-left: 6;" class="fixed-width"></td>
          </tr>
          <tr class="no-border">
            <td>Nova senha: </td>
            <td><input id="novaSenha" type="password" class="fixed-width">
              <button onclick="
                  novaSenha.type = novaSenha.type == 'password' ? 'text' : 'password';
                ">
                <svg width="14px" height="14px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 2L22 22" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M6.71277 6.7226C3.66479 8.79527 2 12 2 12C2 12 5.63636 19 12 19C14.0503 19 15.8174 18.2734 
                    17.2711 17.2884M11 5.05822C11.3254 5.02013 11.6588 5 12 5C18.3636 5 22 12 22 12C22 12 21.3082 
                    13.3317 20 14.8335" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  />
                  <path d="M14 14.2362C13.4692 14.7112 12.7684 15.0001 12 15.0001C10.3431 15.0001 9 13.657 9 
                    12.0001C9 11.1764 9.33193 10.4303 9.86932 9.88818" stroke="#000000" stroke-width="2" 
                    stroke-linecap="round" stroke-linejoin="round"
                  />
                </svg>
              </button></td>
          </tr>
          <tr class="no-border">
            <td>Repita a senha: </td>
            <td><input id="novaSenhaConfirmar" type="password" class="fixed-width">
              <button onclick="
                  novaSenhaConfirmar.type = novaSenhaConfirmar.type == 'password' ? 'text' : 'password';
                ">
                <svg width="14px" height="14px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 2L22 22" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M6.71277 6.7226C3.66479 8.79527 2 12 2 12C2 12 5.63636 19 12 19C14.0503 19 15.8174 18.2734 
                    17.2711 17.2884M11 5.05822C11.3254 5.02013 11.6588 5 12 5C18.3636 5 22 12 22 12C22 12 21.3082 
                    13.3317 20 14.8335" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  />
                  <path d="M14 14.2362C13.4692 14.7112 12.7684 15.0001 12 15.0001C10.3431 15.0001 9 13.657 9 
                    12.0001C9 11.1764 9.33193 10.4303 9.86932 9.88818" stroke="#000000" stroke-width="2" 
                    stroke-linecap="round" stroke-linejoin="round"
                  />
                </svg>
              </button></td>
          </tr>
          <tr class="no-border">
            <td>&nbsp;</td>
          </tr>
          <tr class="no-border">
            <td><button onclick="document.getElementById('login').close();document.getElementById('changeFirstPassword').close();">Cancelar</button></td>
            <td align="right"> <button onclick="event.preventDefault();signup();">Cadastrar</button></td>
          </tr>
        </table>
        <p style="color: red;" id="erroPrimeiroAcesso"></p>
      </dialog>

      <dialog id="loginErro" style="border: 0;" onclick="document.getElementById('loginErro').close()">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td colspan="2"><h3>Não foi possível realizar o login!</h3>Se for a primeira vez que faz login com senha, clique em "Primeiro acesso"<br><br></td>
          </tr>
          <tr class="no-border">
            <td>&nbsp;</td>
          </tr>
        </table>
      </dialog>

      <script src="assets/js/logout.js"></script>
      <script>

function applyCPFFormat(input) {
    // Remove non-numeric characters
    let value = input.value.replace(/\D/g, '');
    let cpf = value;
    let cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;

    value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');

    // Update input value
    input.value = value;
}

async function signup() {
  if (document.getElementById("novoCPF").value == "") {
    document.getElementById("erroPrimeiroAcesso").innerText = "CPF não pode estar em branco";
    return;
  }

  if (document.getElementById("novaSenha").value.length < 6) {
    document.getElementById("erroPrimeiroAcesso").innerText = "A senha precisa ter pelo menos 6 caracteres";
    return;
  }

  if (document.getElementById("novaSenha").value == "") {
    document.getElementById("erroPrimeiroAcesso").innerText = "A senha não pode ficar em branco";
    return;
  }

  if (document.getElementById("novaSenha").value != document.getElementById("novaSenhaConfirmar").value) {
    document.getElementById("erroPrimeiroAcesso").innerText = "A senha digitada não confere";
    return;
  }

  let { data, error } = await supabase.auth.signUp({
    email: `${parseInt(document.getElementById("novoCPF").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`,
    password: document.getElementById("novaSenha").value,
  })
  if (!error) {
    document.getElementById('changeFirstPassword').close();
    cpf.value = '';
    senha.value = '';
    return;
  }

  document.getElementById("erroPrimeiroAcesso").innerText = "Ocorreu um erro, parece que você já se cadastrou";
}

async function loadPage() {
  let a = document.createElement("a");
  a.href = "profissional.html";
  a.click();
}

async function cacheProfissional() {
  const { data, error } = await supabase
  .from('profissional')
  .select()
  .eq('login_id', parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36));

  if (error) {
    document.getElementById('loginErro').showModal();
    return;
  }

  localStorage.setItem("cod_profissional", data[0].profissional_cod);
  localStorage.setItem("profissional_equipes", data[0].profissional_equipes);
  localStorage.setItem("profissional_pagina", data[0].profissional_pagina);

  loadPage();
}

async function login() {
  document.getElementById('login').close();
  const { data, error } = await supabase.auth.signInWithPassword({
    email: `${parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`,
    password: `${document.getElementById("senha").value}`,
  })

  if (error) {
    document.getElementById('loginErro').showModal();
    console.log(error)
    return;
  }
  localStorage.setItem("profissional", `${parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`);

  location.href = "profissional.html";
}

async function changeFirstPassword() {
  await supabase.auth.updateUser({ password: `${document.getElementById("senha").value}` })
}

if (localStorage.getItem("profissional")) {
  loadPage();
}


      </script>
      </body></html>

