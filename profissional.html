<!doctype html>
<html lang="pt_BR">
  <head>
    <meta charset="utf8" />
    <title>Perfil do profissional</title>
    <link href="assets/css/style.css" rel="stylesheet" />
    <style>
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: #333;
        color: #fff;
        padding: 10px 0;
      }

      .navbar a {
        color: #fff;
        text-decoration: none;
        padding: 15px;
      }

      body {
        margin-top: 60px; 
      }

      tr,table,td,th {
        /*border: 1px solid #dfe2e5;*/
        background-color: transparent !important;
        border: 0 !important;
      }

      .header {
        background-color: #f6f8fa !important;
      }

      .border {
        border: 1px solid #dfe2e5 !important;
      }

      ::backdrop {
        background-image: linear-gradient(45deg, rgb(0, 0, 0), rgb(0, 0, 0));
        opacity: 0.75;
      }

      .tr:hover {
        background: #dfe2e5 !important;
        cursor: pointer !important;
      }

      .tr:pressed {
        background: #9fa1a3 !important;
      }

      tbody {
        width: 100%;
      }

      tr img {
        min-width: 96px;
        height: auto;
      }

      tr td:last-child {
        width: 100%;
        padding-left: 10px;
      }
    </style>
    <meta content="lua-wpp" name="generator" />
    <meta content="width=device-width,initial-scale=1.0" name="viewport" />
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script  src="assets/js/config.js"></script>
  </head>
  <body class="container-lg px-3 my-5 markdown-body">
    <div class="navbar" style="display: flex;justify-content: space-between; padding: 0;">
      <a><span id="cod"></span> - <span id="nome"></span></a>
      <a href="#" onclick="logout()"> Fazer logout</a>
    </div>

    <h3><br /></h3>

    <span style="display:block;margin-top: 9px;padding: 9px;border: 2px solid #176b2c;background-color: rgb(242 255 243);color: #176b2c;">
      Uma vers√£o melhorada do portal est√° em desenvolvimento, agrade√ßo pela compreens√£o
    </span>

    <h3><br /></h3>

    <table>
      <tbody id="lista-sessoes"></tbody >
    </table>

    <h3><br /></h3>
    <script src="assets/js/logout.js"></script>
    <script>
      const Sections = {
        "P√°ginas": [
          ["Produ√ß√£o","Veja o consolidado da sua produ√ß√£o ao longo do ano","producao"],
          ["Produ√ß√£o (beta)","Veja o consolidado da sua produ√ß√£o ao longo do ano","producao-ace"],
          ["Situa√ß√£o descritiva dos cadastros","Veja uma lista descritiva dos cadastros com problemas","situacao-cadastros"],
          ["Produ√ß√£o di√°ria","Acompanhe sua produ√ß√£o dia a dia ao longo do ano","producao-diaria"],
          //["Tabela de indicadores e-SUS","Acompanhe semanalmente os indicadores e-SUS","hardlock"],//"indicadores-esus"],
        ],

        /*"Farm√°cia": [
          ["Dispensa√ß√£o de medicamentos","Total de medicamentos dispensados por cada unidade por m√™s","hardlock"],//,"farmacia-monitoramento-consolidado?campo=geral"],
          ["Uso da Farm√°cia de Minas","Percentual de dispensa√ß√£o que cada unidade com fam√°rica corresponde as dispensa√ß√µes da Farm√°cia de Minas","hardlock"],//"farmacia-monitoramento-consolidado?campo=farmaciaminas"],
        ],

        "Tabelas-mapa": [
          ["Fam√≠lias visitadas","Mapa que mostra as fam√≠lias que receberam visitas dos ACS ao longo do ano","hardlock"],//"grafico-de-mapa?script=monitoramento-acs"],
          //["Situa√ß√£o dos pacientes e-SUS","Mapa que mostra o acompanhamento dos pacientes com condicionalidades dos indicadores e-SUS","grafico-de-mapa?acompanhamento-esus"],
        ],

        "Listas e planilhas": [
          ["Lista de prontu√°rios","Veja uma lista dos pacientes agrupados por fam√≠lia e micro-√°rea","lista-prontuario"],
          ["Lista de Casos de Arboviroses e Doen√ßas Relacionadas","Veja uma lista que receberam o diagn√≥stico de arbovirose e doen√ßas relacionadas","hardlock"],//"planilhas?script=pacientes-arbovirose"],
          ["Lista de crian√ßas - Vitamina A de 100 mil UI","Planilha de monitoramento de crian√ßas que n√£o receberam a <i>Vitamina A de 100 mil UI</i>","hardlock"],//"planilhas?script=vitamina-a-100-mil"],
          ["Lista de crian√ßas - Tr√≠plice viral","Planilha de monitoramento de crian√ßas que n√£o receberam 3 doses da <i>Tr√≠plice viral</i>","hardlock"],//"planilhas?script=vacina-triplice-viral"],
        ],

        "Relat√≥rios": [
          ["Censo","Obtenha um quantitativo de pacientes baseado em crit√©rios","hardlock"],//"censo"],
          ["Completude do question√°rio e-sus","Lista os cadastros indicando o n√≠vel de completude do qustion√°rio e-SUS","hardlock"],//"questionario_e-sus"],
        ],

        "Bases de dados": [
          ["Listagem de Pacientes","Obtenha uma listagem nominal de pacientes, filtrados por ACS, ESF e Idade","hardlock"],//"relatorio-51"],
        ],*/

        "Solicita√ß√µes": [
          ["Agendadas","Solicita√ß√µes agendadas ativas","agendados"],
          ["Devolvidas","Solu√ß√µes com problemas que precisam ser analisados","solicitacoes"],
        ],
        "Links": [
          ["Envio de documentos","Envie e/ou atualize sua documenta√ß√£o profissional","hardlock"],//"enviar-arquivo"],
        ],
        "Ferramentas de gest√£o": [
          ["Editor de equipes ESF","Crie, edite e remova equipes tipo ESF","editor-equipes-esf"],
          ["Gerenciar profissionais","Adicione e remova acesso de pofissional","editor-profissional"],
        ],
        "Profissionais de n√≠vel m√©dio": [
          ["Agente de Combate a Endemias","","lista-profissional-ace"],
          ["Agente Comunit√°rio de Sa√∫de","","lista-profissional-acs"],
          ["Recepcionista","","lista-profissional-recepcionista"],
        ],
        "Profissionais de n√≠vel superior": [
          ["Cirurgi√£o dentista","","lista-profissional-cirurgiao_dentista"],
          ["Enfermeiro","","lista-profissional-enfermeiro"],
          ["Farmac√™utico","","lista-profissional-farmaceutico"],
          ["M√©dico","","lista-profissional-medico"],
          ["Psic√≥logo","","lista-profissional-psicologo"],
        ],
      }
    </script>
    <script>

      function openPage(link) {
        location.href = link
      }

      let cbo = "";

      (
        async () => {
          let codProfissional = 0;
          let recepcionista = false;
          let trocarProfissional = false;
          let naoACS = false;

          if (localStorage.getItem('override:codProfissional')) {
            const {data:profissional,error} = await supabase.from('dadosprofissionais').select("*").eq('codprofissional', localStorage.getItem('override:codProfissional'));
            document.getElementById("nome").innerText = profissional[0].nome;
            codProfissional = profissional[0].codprofissional;
            nomeProfissional = profissional[0].nome;
            document.getElementById("cod").innerText = `ü™™ ${codProfissional.replace("-","").replace("@","").replace("+","")}`;
            document.getElementById("nome").innerText = nomeProfissional;
            localStorage.setItem("codProfissional",codProfissional);
          } else {
            const {data,error} = await window.supabase.from('dadosprofissionais').select("*").eq('cpf', localStorage.getItem("profissional"));
            document.getElementById("cod").innerText = data[0].codprofissional.replace("-","").replace("@","").replace("+","");
            document.getElementById("nome").innerText = data[0].nome;
            codProfissional = data[0].codprofissional;
          }

          for (const [titulo, items] of Object.entries(Sections)) {
            if (document.getElementById("lista-sessoes").innerHTML != "") {
              document.getElementById("lista-sessoes").innerHTML+=`
                <tr name="${titulo}">
                  <th colspan="2" align="left"><br></th>
                </tr>
              `;
            }

            document.getElementById("lista-sessoes").innerHTML+=`
              <tr class="border header" name="${titulo}">
                <th colspan="2" align="left">${titulo}</th>
              </tr>
            `;

            for (item of items) {
              let pagina = item[2].split("?")[0];
              let query = item[2].split("?")[1] || "q=undefined";

              if (item[2].split("?")[0].startsWith("lista-profissional")) {
                query = "q="+pagina.replace("lista-profissional-","");
                pagina = "lista-profissional";
              }

              document.getElementById("lista-sessoes").innerHTML+=`
                <tr class="border tr profissional" onclick="openPage('${pagina}.html?${query}');" name="${titulo}" id="${item[0]}">
                  <td>
                    <img src="assets/img/${item[2].split("?")[0]}.png" width="96" />
                  </td>
                  <td style="" name="${titulo}">
                    <b>${item[0]}</b><br/>${item[1]}
                  </td>
                </tr>
              `;
            }
          }

          // Gest√£o da APS
          if (parseInt(codProfissional) < 0 ) {
            for (let grupo of ["Tabelas-mapa","Listas e planilhas","Links"]) {
              for (let linha of [...document.getElementsByName(grupo)]) {
                linha.remove();
              }
            }
            for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Produ√ß√£o di√°ria","Completude do question√°rio e-sus"]) {
              document.getElementById(grupo)?.remove();
            }
            return;
          }

          // Preceptores
          if (codProfissional.startsWith("@")) {
            for (let grupo of ["Tabelas-mapa","Listas e planilhas","Solicita√ß√µes","Ferramentas de gest√£o","Farm√°cia"]) {
              for (let linha of [...document.getElementsByName(grupo)]) {
                linha.remove();
              }
            }
            for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Produ√ß√£o di√°ria","Completude do question√°rio e-sus"]) {
              document.getElementById(grupo)?.remove();
            }
            return;
          }

          // Coordenadores da Aten√ß√£o especializada
          if (codProfissional.startsWith("$")) {
            for (let grupo of ["P√°ginas","Farm√°cia","Tabelas-mapa","Listas e planilhas","Links",
                               "Ferramentas de gest√£o","Profissionais de n√≠vel m√©dio","Profissionais de n√≠vel superior"]) {
              for (let linha of [...document.getElementsByName(grupo)]) {
                linha.remove();
              }
              for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Produ√ß√£o di√°ria","Completude do question√°rio e-sus","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
              }
            }
            return;
          }

          let { data: equipes, error } = await supabase.from('equipes').select('*');
          for (let equipe of equipes) {
            let profissionais = equipe.profissionais.split(",");

            // ACE
            if (profissionais.includes(`ace_1:${codProfissional}`) || profissionais.includes(`ace_2:${codProfissional}`)) {
              for (let grupo of ["Farm√°cia","Solicita√ß√µes","Tabelas-mapa","Listas e planilhas","Links",
                                 "Ferramentas de gest√£o","Profissionais de n√≠vel m√©dio","Profissionais de n√≠vel superior"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus",
                                   "Tabela de indicadores e-SUS"]) {
                  document.getElementById(grupo)?.remove();
                }
              }
              return;
            }

            // Recepcionistas
            if (profissionais.includes(`recepcionista_saude_na_hora:${codProfissional}`) || profissionais.includes(`recepcionista:${codProfissional}`)) {
              for (let grupo of ["P√°ginas","Farm√°cia","Tabelas-mapa","Listas e planilhas","Links",
                                 "Ferramentas de gest√£o","Profissionais de n√≠vel m√©dio","Profissionais de n√≠vel superior"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Produ√ß√£o di√°ria","Completude do question√°rio e-sus"]) {
                  document.getElementById(grupo)?.remove();
                }
              }
              return;
            }

            // Enfermeiros
            if (profissionais.includes(`enfermeiro_saude_na_hora:${codProfissional}`) || profissionais.includes(`enfermeiro:${codProfissional}`)) {
              for (let grupo of ["Farm√°cia","Tabelas-mapa","Ferramentas de gest√£o"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus","Lista de prontu√°rios","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
                }

                for (let grupo of document.getElementsByName("Profissionais de n√≠vel superior")) {
                  if (grupo.tagName != "TR") continue;
                  if (!grupo.classList.contains("profissional")) continue;
                  if (grupo.id == "M√©dico") continue;

                  grupo.style.display = "none";
                }
              }
              return;
            }

            // Psicologos
            if (profissionais.includes(`psicologo:${codProfissional}`)) {
              for (let grupo of ["Farm√°cia","Tabelas-mapa","Ferramentas de gest√£o"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus","Lista de prontu√°rios","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
                }

                for (let grupo of document.getElementsByName("Profissionais de n√≠vel superior")) {
                  if (grupo.tagName != "TR") continue;
                  if (!grupo.classList.contains("profissional")) continue;
                  if (grupo.id == "M√©dico") continue;

                  grupo.style.display = "none";
                }
              }
              return;
            }

            // M√©dicos
            if (profissionais.includes(`medico_saude_na_hora:${codProfissional}`) || profissionais.includes(`medico:${codProfissional}`)) {
              for (let grupo of ["Farm√°cia","Tabelas-mapa","Profissionais de n√≠vel m√©dio","Profissionais de n√≠vel superior","Ferramentas de gest√£o"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus","Lista de prontu√°rios","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
                }
              }
              return;
            }
            
            // Farmac√™uticos
            if (profissionais.includes(`farmaceutico:${codProfissional}`)) {
              for (let grupo of ["Tabelas-mapa","Ferramentas de gest√£o"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus","Lista de prontu√°rios","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
                }

                for (let grupo of document.getElementsByName("Profissionais de n√≠vel superior")) {
                  if (grupo.tagName != "TR") continue;
                  if (!grupo.classList.contains("profissional")) continue;
                  if (grupo.id == "M√©dico") continue;

                  grupo.style.display = "none";
                }
              }
              return;
            }

            // Odont√≥logos
            if (profissionais.includes(`cirurgiao_dentista:${codProfissional}`)) {
              for (let grupo of ["Farm√°cia","Tabelas-mapa","Ferramentas de gest√£o","Solicita√ß√µes","Listas e planilhas"]) {
                for (let linha of [...document.getElementsByName(grupo)]) {
                  linha.remove();
                }
                for (let grupo of ["Produ√ß√£o","Situa√ß√£o descritiva dos cadastros","Completude do question√°rio e-sus","Lista de prontu√°rios","Agendadas"]) {
                  document.getElementById(grupo)?.remove();
                }
                for (let grupo of document.getElementsByName("Profissionais de n√≠vel superior")) {
                  if (grupo.tagName != "TR") continue;
                  if (!grupo.classList.contains("profissional")) continue;
                  if (grupo.id == "M√©dico") continue;

                  grupo.style.display = "none";
                }
              }
              return;
            }
          }

          for (let grupo of ["Farm√°cia","Solicita√ß√µes","Links","Ferramentas de gest√£o","Profissionais de n√≠vel m√©dio","Profissionais de n√≠vel superior"]) {
            for (let linha of [...document.getElementsByName(grupo)]) {
              linha.remove();
            }
            for (let grupo of ["Lista de Casos de Arboviroses e Doen√ßas Relacionadas","Lista de prontu√°rios"]) {
              document.getElementById(grupo)?.remove();
            }
          }

          
      }
    )();
    </script>
  </body>
</html>
